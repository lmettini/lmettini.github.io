<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Dummy links- lmettini</title>

    <script type="text/javascript" src="http://code.jquery.com/jquery-2.1.3.js"></script>
    <script type="text/javascript" src="js/url.min.js"></script>
    
</head>

<body>

    <input type="button" id="deeplink" value="GO!GO!GO! (js redirect)"/>
    <hr>
    <a id="linky" href="#">GO!GO!GO! (native redirect)</a>

    <iframe id='iframePlayground' style="display:none" src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACwAAAAAAQABAAACAkQBADs="></iframe>

    <script >
        var method = url('?method');
        var newurl = url('?newurl');

        var redirectToNewurl = function() {
            alert('redirecting to '+newurl);
            window.location = newurl;
        }

        document.getElementById("linky").href=newurl; 


        if(method=='injectIframe'){
            var timeOfDL = new Date().getTime();
            $('#iframePlayground').attr('src',newurl)
            setTimeout(function(){
                if(new Date().getTime() - timeOfDL < 600){
                    alert('it looks your deeplink didn\'t work');
                    window.location = 'https://play.google.com/store/apps/details?id=com.booking&hl=en';
                    
                }
            },400);
        }

        if(method=='onLoading'){
            redirectToNewurl();
        }


        if(method=='wechat'){
            var fn = (function() {
                var times = 2;
                return function() {
                    location.href = newurl;
                    if (times) {
                        setTimeout(arguments.callee, 1000);
                    }
                    times = times - 1;
                };
            })();
            setTimeout(function() {
                fn();
            }, 1000);
        }

        $('#deeplink').on('click',function(){
            redirectToNewurl();
        });
    </script>

</body>

</html>
